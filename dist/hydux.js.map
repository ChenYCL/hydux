{"version":3,"sources":["webpack:///hydux.js","webpack:///webpack/bootstrap 0d1abe9fa1e048688443","webpack:///./src/cmd.ts","webpack:///./src/index.ts","webpack:///./src/utils.ts"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","1","value","default","none","ofPromise","task","args","succeedAction","failedAction","_","then","catch","ofFn","e","ofSub","sub","batch","cmds","_i","arguments","length","Array","concat","apply","map","cmd","actions","12","normalizeActionResult","result","state","utils_1","isFunction","cmd_1","app","props","appRender","appState","view","appActions","render","err","console","error","onError","init","from","path","key","action","msgData","nextState","nextAppState","_a","onUpdate","setDeep","merge","prevAppState","join","forEach","appSubscribe","subscribe","log","noop","__assign","getState","this","assign","t","Cmd","4","set","to","slice","data","f"],"mappings":"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","file":"hydux.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 12);\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ 1:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = {\r\n    none: [],\r\n    ofPromise: function (task, args, succeedAction, failedAction) {\r\n        return [\r\n            function (_) {\r\n                task(args)\r\n                    .then(succeedAction)\r\n                    .catch(failedAction);\r\n            }\r\n        ];\r\n    },\r\n    ofFn: function (task, args, succeedAction, failedAction) {\r\n        return [\r\n            function (_) {\r\n                try {\r\n                    succeedAction(task(args));\r\n                }\r\n                catch (e) {\r\n                    failedAction(e);\r\n                }\r\n            }\r\n        ];\r\n    },\r\n    ofSub: function (sub) {\r\n        return [sub];\r\n    },\r\n    batch: function () {\r\n        var cmds = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            cmds[_i] = arguments[_i];\r\n        }\r\n        return Array.prototype.concat.apply([], cmds);\r\n    },\r\n    map: function (map, cmd) {\r\n        return cmd.map(function (sub) { return function (actions) { return sub(map(actions)); }; });\r\n    }\r\n};\r\n\n\n/***/ }),\n\n/***/ 12:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar cmd_1 = __webpack_require__(1);\r\nexports.Cmd = cmd_1.default;\r\nvar utils_1 = __webpack_require__(4);\r\nexports.noop = utils_1.noop;\r\nfunction normalizeActionResult(result, state, actions) {\r\n    utils_1.isFunction(result) && (result = result(state));\r\n    utils_1.isFunction(result) && (result = result(actions));\r\n    if (result instanceof Array) {\r\n        return result;\r\n    }\r\n    return [result, cmd_1.default.none];\r\n}\r\nfunction app(props) {\r\n    // const appEvents = props.events || {}\r\n    var appActions = {};\r\n    var appSubscribe = props.subscribe || (function (_) { return cmd_1.default.none; });\r\n    var render = props.render || console.log;\r\n    var onError = props.onError || utils_1.noop;\r\n    // const appMiddlewares = props.middlewares || []\r\n    var _a = normalizeActionResult(props.init(), void 0, appActions), appState = _a[0], cmd = _a[1];\r\n    init(appState, appActions, props.actions, []);\r\n    cmd.forEach(function (sub) { return sub(appActions); });\r\n    appRender(appState);\r\n    appSubscribe(appState).forEach(function (sub) { return sub(appActions); });\r\n    return __assign({}, props, { actions: appActions, getState: function () { return appState; }, render: appRender });\r\n    function appRender(state) {\r\n        if (state !== appState) {\r\n            appState = state;\r\n        }\r\n        var view;\r\n        if (utils_1.isFunction(view = props.view(appState))) {\r\n            view = view(appActions);\r\n        }\r\n        try {\r\n            return render(view);\r\n        }\r\n        catch (err) {\r\n            console.error(err);\r\n            onError(err);\r\n        }\r\n    }\r\n    function init(state, actions, from, path) {\r\n        for (var key in from) {\r\n            utils_1.isFunction(from[key])\r\n                ? (function (key, action) {\r\n                    actions[key] = function (msgData) {\r\n                        state = utils_1.get(path, appState);\r\n                        // action = appMiddlewares.reduce((action, fn) => fn(action, key, path), action)\r\n                        var nextState = state;\r\n                        var nextAppState = appState;\r\n                        var cmd = cmd_1.default.none;\r\n                        try {\r\n                            _a = normalizeActionResult(action(msgData), state, actions), nextState = _a[0], cmd = _a[1];\r\n                        }\r\n                        catch (error) {\r\n                            console.error(error);\r\n                            onError(error);\r\n                        }\r\n                        if (props.onUpdate) {\r\n                            nextAppState = utils_1.setDeep(path, utils_1.merge(state, nextState), appState);\r\n                            props.onUpdate({ prevAppState: appState, nextAppState: nextAppState, msgData: msgData, action: path.concat(key).join('.') });\r\n                        }\r\n                        if (nextState !== state) {\r\n                            appState = nextAppState !== appState\r\n                                ? nextAppState\r\n                                : utils_1.setDeep(path, utils_1.merge(state, nextState), appState);\r\n                            appRender(appState);\r\n                        }\r\n                        cmd.forEach(function (sub) { return sub(appActions); });\r\n                        return msgData;\r\n                        var _a;\r\n                    };\r\n                })(key, from[key])\r\n                : init(state[key] || (state[key] = {}), (actions[key] = {}), from[key], path.concat(key));\r\n        }\r\n    }\r\n}\r\nexports.default = app;\r\n\n\n/***/ }),\n\n/***/ 4:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction set(to, from) {\r\n    for (var i in from) {\r\n        to[i] = from[i];\r\n    }\r\n    return to;\r\n}\r\nexports.set = set;\r\nfunction merge(to, from) {\r\n    return set(set({}, to), from);\r\n}\r\nexports.merge = merge;\r\nfunction setDeep(path, value, from) {\r\n    var to = {};\r\n    return 0 === path.length\r\n        ? value\r\n        : ((to[path[0]] =\r\n            1 < path.length\r\n                ? setDeep(path.slice(1), value, from[path[0]])\r\n                : value),\r\n            merge(from, to));\r\n}\r\nexports.setDeep = setDeep;\r\nfunction get(path, from) {\r\n    for (var i = 0; i < path.length; i++) {\r\n        from = from[path[i]];\r\n    }\r\n    return from;\r\n}\r\nexports.get = get;\r\nfunction isFunction(data) {\r\n    return 'function' === typeof data;\r\n}\r\nexports.isFunction = isFunction;\r\nexports.noop = function (f) { return f; };\r\n\n\n/***/ })\n\n/******/ });\n\n\n// WEBPACK FOOTER //\n// hydux.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 0d1abe9fa1e048688443","import { CmdType } from './cmd'\nimport { ActionResult, ActionType, ActionsType } from './types'\n\nexport type Sub<State, Actions> = (actions: ActionsType<State, Actions>) => void | null\nexport type CmdType<State, Actions> = Sub<State, Actions>[]\nexport default {\n  none: ([] as Array<Sub<any, any>>),\n  ofPromise<A, T, State, Actions>(\n    task: (args: A) => Promise<T>,\n    args: A,\n    succeedAction?: ActionType<T, State, Actions>,\n    failedAction?: ActionType<Error, State, Actions>\n  ): CmdType<State, Actions> {\n    return [\n      _ => {\n        task(args)\n        .then(succeedAction)\n        .catch(failedAction)\n      }\n    ]\n  },\n  ofFn<A, T, State, Actions>(\n    task: (args: A) => T,\n    args: A,\n    succeedAction: ActionType<T, State, Actions>,\n    failedAction: ActionType<Error, State, Actions>\n  ): CmdType<State, Actions> {\n    return [\n      _ => {\n        try {\n          succeedAction(task(args))\n        } catch (e) {\n          failedAction(e)\n        }\n      }\n    ]\n  },\n  ofSub<State, Actions>(sub: Sub<State, Actions>) {\n    return [sub]\n  },\n  batch<State, Actions>(...cmds: CmdType<State, Actions>[]) {\n    return Array.prototype.concat.apply([], cmds)\n  },\n  map<State, Actions, SubActions>(map: (action: ActionsType<State, Actions>) => ActionsType<State, SubActions>, cmd: CmdType<State, SubActions>): CmdType<State, Actions> {\n    return cmd.map(sub => actions => sub(map(actions)))\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cmd.ts","import { ActionResult, ActionState, ActionStateWithCmd, ActionType, ActionsType } from './types'\nimport Cmd, { CmdType } from './cmd'\nimport { set, merge, setDeep, get, isFunction, noop } from './utils'\n\nexport type Init<S, A> = () => S | [S, CmdType<S, A>]\nexport type View<S, A> = (appState: S) => ((actions: A) => any)\nexport type Subscribe<S, A> = (state: S) => CmdType<S, A>\nexport type OnUpdate<S, A> = <M>(data: { prevAppState: S, nextAppState: S, msgData: M, action: string }) => void\n\nexport { Cmd, noop }\n\nexport type AppProps<State, Actions> = {\n  init: Init<State, Actions>,\n  view: View<State, Actions>\n  actions: ActionsType<State, Actions>,\n  subscribe?: Subscribe<State, Actions>,\n  // middlewares: ((action: MyAction<any, State, Actions>, key: string, path: string[]) => MyAction<any, State, Actions>)[],\n  render?: (view: any) => void,\n  onError?: (err: Error) => void,\n  onUpdate?: OnUpdate<State, Actions>,\n}\n\nfunction normalizeActionResult<State, Actions>(result, state, actions): ActionStateWithCmd<State, Actions> {\n  isFunction(result) && (result = result(state))\n  isFunction(result) && (result = result(actions))\n\n  if (result instanceof Array) {\n    return result as any\n  }\n  return [result, Cmd.none]\n}\n\nexport type App<State, Actions> = (props: AppProps<State, Actions>) => any\n\nexport default function app<State, Actions>(props: AppProps<State, Actions>) {\n  // const appEvents = props.events || {}\n  const appActions = {} as ActionsType<State, Actions>\n  const appSubscribe = props.subscribe || (_ => Cmd.none)\n  const render = props.render || console.log\n  const onError = props.onError || noop\n  // const appMiddlewares = props.middlewares || []\n  let [appState, cmd] = normalizeActionResult(props.init(), void 0, appActions) as [State, CmdType<State, Actions>]\n\n  init(appState, appActions, props.actions, [])\n  cmd.forEach(sub => sub(appActions))\n  appRender(appState)\n  appSubscribe(appState).forEach(sub => sub(appActions))\n\n  return {\n    ...props,\n    actions: appActions,\n    getState() { return appState },\n    render: appRender\n  }\n\n  function appRender(state) {\n    if (state !== appState) {\n      appState = state\n    }\n    let view\n    if (isFunction(view = props.view(appState))) {\n      view = view(appActions)\n    }\n    try {\n      return render(view)\n    } catch (err) {\n      console.error(err)\n      onError(err)\n    }\n  }\n\n  function init(state, actions, from: ActionsType<State, Actions> | ActionType<any, State, Actions>, path: string[]) {\n    for (const key in from) {\n      isFunction(from[key])\n        ? ((key, action: ActionType<any, State, Actions>) => {\n          actions[key] = function(msgData) {\n            state = get(path, appState)\n            // action = appMiddlewares.reduce((action, fn) => fn(action, key, path), action)\n            let nextState = state\n            let nextAppState = appState\n            let cmd = Cmd.none\n            try {\n              [nextState, cmd] = normalizeActionResult(action(msgData), state, actions)\n            } catch (error) {\n              console.error(error)\n              onError(error)\n            }\n\n            if (props.onUpdate) {\n              nextAppState = setDeep(path, merge(state, nextState), appState)\n              props.onUpdate({ prevAppState: appState, nextAppState, msgData, action: path.concat(key).join('.') })\n            }\n\n            if (nextState !== state) {\n              appState = nextAppState !== appState\n                ? nextAppState\n                : setDeep(path, merge(state, nextState), appState)\n              appRender(appState)\n            }\n            cmd.forEach(sub => sub(appActions))\n            return msgData\n          }\n        })(key, from[key])\n        : init(\n            state[key] || (state[key] = {}),\n            (actions[key] = {}),\n            from[key],\n            path.concat(key)\n          )\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.ts","\nexport function set(to, from) {\n  for (const i in from) {\n    to[i] = from[i]\n  }\n  return to\n}\n\nexport function merge(to, from) {\n  return set(set({}, to), from)\n}\n\nexport function setDeep(path, value, from) {\n  const to = {}\n  return 0 === path.length\n    ? value\n    : ((to[path[0]] =\n        1 < path.length\n          ? setDeep(path.slice(1), value, from[path[0]])\n          : value),\n      merge(from, to))\n}\n\nexport function get(path, from) {\n  for (let i = 0; i < path.length; i++) {\n    from = from[path[i]]\n  }\n  return from\n}\n\nexport function isFunction(data): data is Function {\n  return 'function' === typeof data\n}\n\nexport const noop = f => f\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.ts"],"sourceRoot":""}